const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ProcessesView.js","assets/table.js","assets/vendor.js","assets/useInterval.js","assets/LogsView.js","assets/react-select.esm.js","assets/ArrView.js","assets/ConfigView.js"])))=>i.map(i=>d[i]);
import{r as xe,a as _e}from"./vendor.js";import{r as n}from"./table.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&l(h)}).observe(document,{childList:!0,subtree:!0});function o(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(r){if(r.ep)return;r.ep=!0;const a=o(r);fetch(r.href,a)}})();var z={exports:{}},T={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z;function Ce(){if(Z)return T;Z=1;var e=xe(),s=Symbol.for("react.element"),o=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,r=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function h(p,f,i){var g,d={},m=null,v=null;i!==void 0&&(m=""+i),f.key!==void 0&&(m=""+f.key),f.ref!==void 0&&(v=f.ref);for(g in f)l.call(f,g)&&!a.hasOwnProperty(g)&&(d[g]=f[g]);if(p&&p.defaultProps)for(g in f=p.defaultProps,f)d[g]===void 0&&(d[g]=f[g]);return{$$typeof:s,type:p,key:m,ref:v,props:d,_owner:r.current}}return T.Fragment=o,T.jsx=h,T.jsxs=h,T}var ee;function ke(){return ee||(ee=1,z.exports=Ce()),z.exports}var t=ke(),M={},te;function je(){if(te)return M;te=1;var e=_e();return M.createRoot=e.createRoot,M.hydrateRoot=e.hydrateRoot,M}var Se=je();const Ee="modulepreload",Re=function(e){return"/static/"+e},se={},V=function(s,o,l){let r=Promise.resolve();if(o&&o.length>0){let f=function(i){return Promise.all(i.map(g=>Promise.resolve(g).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),p=h?.nonce||h?.getAttribute("nonce");r=f(o.map(i=>{if(i=Re(i),i in se)return;se[i]=!0;const g=i.endsWith(".css"),d=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${d}`))return;const m=document.createElement("link");if(m.rel=g?"stylesheet":Ee,g||(m.as="script"),m.crossOrigin="",m.href=i,p&&m.setAttribute("nonce",p),document.head.appendChild(m),g)return new Promise((v,y)=>{m.addEventListener("load",v),m.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${i}`)))})}))}function a(h){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=h,window.dispatchEvent(p),!p.defaultPrevented)throw h}return r.then(h=>{for(const p of h||[])p.status==="rejected"&&a(p.reason);return s().catch(a)})},ae=n.createContext(void 0);let Ie=0;function Le({children:e}){const[s,o]=n.useState([]),l=n.useCallback(h=>{o(p=>p.filter(f=>f.id!==h))},[]),r=n.useCallback((h,p="info")=>{const f=++Ie;o(i=>[...i,{id:f,message:h,kind:p}]),window.setTimeout(()=>l(f),3500)},[l]),a=n.useMemo(()=>({toasts:s,push:r,dismiss:l}),[s,r,l]);return t.jsx(ae.Provider,{value:a,children:e})}function ce(){const e=n.useContext(ae);if(!e)throw new Error("useToast must be used within a ToastProvider");return e}function Ne(){const{toasts:e,dismiss:s}=ce();return e.length?t.jsx("div",{className:"toasts",children:e.map(o=>t.jsx("div",{className:`toast ${o.kind!=="info"?o.kind:""}`,role:"status",onClick:()=>s(o.id),children:o.message},o.id))}):null}const ie=n.createContext(void 0);function Te({children:e}){const[s,o]=n.useState(""),l=n.useRef(new Set),r=n.useCallback(f=>{o(f),l.current.forEach(i=>{i?.(f)})},[]),a=n.useCallback(f=>{f&&l.current.add(f)},[]),h=n.useCallback(f=>{l.current.delete(f)},[]),p=n.useMemo(()=>({value:s,setValue:r,register:a,clearHandler:h}),[s,r,a,h]);return t.jsx(ie.Provider,{value:p,children:e})}function Ue(){const e=n.useContext(ie);if(!e)throw new Error("useSearch must be used within a SearchProvider");return e}const Pe={"Content-Type":"application/json"},J=["token","webui-token","webui_token"],Ae=1;function $e(){for(const e of J){const s=localStorage.getItem(e)||sessionStorage.getItem(e);if(s)return e!=="token"&&localStorage.setItem("token",s),s}try{const s=new URLSearchParams(window.location.search).get("token");if(s)return localStorage.setItem("token",s),s}catch{}return null}function Oe(){for(const e of J)localStorage.removeItem(e);try{for(const e of J)sessionStorage.removeItem(e)}catch{}}function De(e,s){const o=new Headers(e?.headers||{});return Object.entries(Pe).forEach(([l,r])=>{o.has(l)||o.set(l,r)}),s&&!o.has("Authorization")&&o.set("Authorization",`Bearer ${s}`),{...e,headers:o}}async function G(e,s,o,l=Ae){const r=$e(),a=await fetch(e,De(s,r));return a.status===401&&l>0&&r?(Oe(),G(e,s,o,l-1)):o(a)}async function x(e,s){return G(e,s,o=>Ve(o))}async function Me(e,s){return G(e,s,o=>qe(o))}async function Ve(e){if(!e.ok){let s=null;try{s=await e.json()}catch{}let o=`${e.status} ${e.statusText}`;if(s&&typeof s=="object"&&"error"in s&&typeof s.error=="string"){const l=s.error;l.trim()&&(o=l)}throw new Error(o)}return await e.json()}async function qe(e){if(!e.ok)throw new Error(`${e.status} ${e.statusText}`);return e.text()}async function re(e){const s=e?.force?"?force=1":"";return x(`/web/meta${s}`)}async function ne(){return x("/web/status")}async function lt(){return x("/web/processes")}async function ut(e,s){const o=`/web/processes/${encodeURIComponent(e)}/${encodeURIComponent(s)}/restart`;return x(o,{method:"POST"})}async function dt(){return x("/web/processes/restart_all",{method:"POST"})}async function ft(){return x("/web/arr/rebuild",{method:"POST"})}async function mt(){return x("/web/logs")}async function ht(e){return Me(`/web/logs/${encodeURIComponent(e)}`)}function pt(e){return`/web/logs/${encodeURIComponent(e)}/download`}async function gt(){return x("/web/arr")}async function vt(e,s,o,l){const r=new URLSearchParams;return r.set("page",String(s)),r.set("page_size",String(o)),l&&r.set("q",l),x(`/web/radarr/${encodeURIComponent(e)}/movies?${r}`)}async function wt(e,s,o,l,r){const a=new URLSearchParams;return a.set("page",String(s)),a.set("page_size",String(o)),l&&a.set("q",l),r?.missingOnly&&a.set("missing","1"),x(`/web/sonarr/${encodeURIComponent(e)}/series?${a}`)}async function yt(e,s,o,l){const r=new URLSearchParams;return r.set("page",String(s)),r.set("page_size",String(o)),l&&r.set("q",l),x(`/web/lidarr/${encodeURIComponent(e)}/albums?${r}`)}async function bt(e){await x(`/web/arr/${encodeURIComponent(e)}/restart`,{method:"POST"})}async function Be(){return x("/web/config")}async function We(e){await x("/web/config",{method:"POST",body:JSON.stringify(e)})}async function He(){await x("/web/update",{method:"POST"})}const le=n.createContext(null);function ze({children:e}){const[s,o]=n.useState({liveArr:!0,groupSonarr:!0,viewDensity:"comfortable",theme:"dark"}),[l,r]=n.useState(!0);n.useEffect(()=>{(async()=>{try{const v=(await Be())?.WebUI,y=localStorage.getItem("viewDensity"),_=localStorage.getItem("theme"),S=v?.Theme,R=_||S?.toLowerCase()||"dark";o({liveArr:v?.LiveArr===!0,groupSonarr:v?.GroupSonarr===!0,viewDensity:y||"comfortable",theme:R}),document.documentElement.setAttribute("data-theme",R)}catch(m){console.error("Failed to load WebUI settings:",m)}finally{r(!1)}})()},[]);const a=n.useCallback(async(d,m)=>{try{const v={WebUI:{[d]:m}};await We({changes:v})}catch(v){console.error(`Failed to save ${d}:`,v)}},[]),h=n.useCallback(d=>{o(m=>({...m,liveArr:d})),a("LiveArr",d)},[a]),p=n.useCallback(d=>{o(m=>({...m,groupSonarr:d})),a("GroupSonarr",d)},[a]),f=n.useCallback(d=>{o(m=>({...m,viewDensity:d})),localStorage.setItem("viewDensity",d)},[]),i=n.useCallback(d=>{o(m=>({...m,theme:d})),localStorage.setItem("theme",d),document.documentElement.setAttribute("data-theme",d),a("Theme",d.charAt(0).toUpperCase()+d.slice(1))},[a]),g={liveArr:s.liveArr,groupSonarr:s.groupSonarr,viewDensity:s.viewDensity,theme:s.theme,setLiveArr:h,setGroupSonarr:p,setViewDensity:f,setTheme:i,loading:l};return t.jsx(le.Provider,{value:g,children:e})}function Fe(){const e=n.useContext(le);if(!e)throw new Error("useWebUI must be used within WebUIProvider");return e}function Je(){const[e,s]=n.useState(navigator.onLine);return n.useEffect(()=>{const o=()=>s(!0),l=()=>s(!1);return window.addEventListener("online",o),window.addEventListener("offline",l),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",l)}},[]),e}function j({src:e,alt:s,className:o,...l}){return t.jsx("img",{src:e,alt:s??"",className:o?`icon ${o}`:"icon","aria-hidden":s?void 0:!0,...l})}const oe="/static/assets/close.svg",ue="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20viewBox='0%200%20512%20512'%3e%3cpath%20d='M256%206.3C114.6%206.3%200%20120.9%200%20262.3c0%20113.3%2073.3%20209%20175%20242.9%2012.8%202.2%2017.6-5.4%2017.6-12.2%200-6.1-.3-26.2-.3-47.7-64.3%2011.8-81-15.7-86.1-30.1-2.9-7.4-15.4-30.1-26.2-36.2-9-4.8-21.8-16.6-.3-17%2020.2-.3%2034.6%2018.6%2039.4%2026.2%2023%2038.7%2059.8%2027.8%2074.6%2021.1%202.2-16.6%209-27.8%2016.3-34.2-57-6.4-116.5-28.5-116.5-126.4%200-27.8%209.9-50.9%2026.2-68.8-2.6-6.4-11.5-32.6%202.6-67.8%200%200%2021.4-6.7%2070.4%2026.2%2020.5-5.8%2042.2-8.6%2064-8.6s43.5%202.9%2064%208.6c49-33.3%2070.4-26.2%2070.4-26.2%2014.1%2035.2%205.1%2061.4%202.6%2067.8%2016.3%2017.9%2026.2%2040.6%2026.2%2068.8%200%2098.2-59.8%20120-116.8%20126.4%209.3%208%2017.3%2023.4%2017.3%2047.4%200%2034.2-.3%2061.8-.3%2070.4%200%206.7%204.8%2014.7%2017.6%2012.2C438.7%20471.3%20512%20375.3%20512%20262.3c0-141.4-114.6-256-256-256'%20style='fill-rule:evenodd;clip-rule:evenodd;fill:%231b1f23'/%3e%3c/svg%3e",Ke="/static/assets/refresh-arrow.svg",de="/static/assets/up-arrow.svg",Ge="/static/assets/process.svg",Ye="/static/assets/log.svg",Qe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20id='Layer_1'%20x='0'%20y='0'%20version='1.1'%20viewBox='0%200%20512%20512'%3e%3cstyle%3e.st0{fill:%2324292e}%3c/style%3e%3cg%20id='Group-Copy'%20transform='translate(70%2021)'%3e%3cpath%20id='Shape'%20d='m10.3%2059.8%203.9%20372.4c-31.4%203.9-54.9-11.8-54.9-43.1l-3.9-309.7c0-98%2090.2-121.5%20145.1-82.3l278.3%20160.7c39.2%2027.4%2047%2078.4%2027.4%20113.7-3.9-27.4-15.7-43.1-39.2-58.8L53.4%2036.2C29.9%2020.6%2010.3%2024.5%2010.3%2059.8'%20class='st0'/%3e%3cpath%20id='Shape_00000114049535938561773820000018271523940913105341_'%20d='M-13.2%20451.8c23.5%207.8%2047%203.9%2066.6-7.8l321.5-188.2c19.6%2027.4%2015.7%2054.9-7.8%2070.6L96.5%20483.2c-39.2%2019.6-90.1%200-109.7-31.4'%20class='st0'/%3e%3cpath%20id='Shape_00000165935924413286433040000003668002807793862576_'%20d='M80.9%20342%20273%20232.3%2084.8%20126.4z'%20style='fill:%23ffc230'/%3e%3c/g%3e%3c/svg%3e",Xe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20viewBox='0%200%20512%20512'%3e%3cpath%20d='M511.8%20256c0%2070.4-24.9%20130.8-74.6%20181.1-1.7%202-3.5%203.8-5.5%205.4-8.2%208-16.8%2015.3-26%2021.8Q341.05%20512%20256.3%20512c-56.6%200-106.3-15.9-149.2-47.7-11.3-8-22-17.1-31.9-27.3C36.5%20398.7%2012.8%20354%204%20303.2c-1.7-9.9-2.9-20-3.4-30.2-.2-5.7-.4-11.3-.4-17%200-6%20.1-11.7.4-17.1%200-.6.2-1.1.5-1.7%203.7-62.8%2028.4-117%2074.1-162.8C125.5%2024.8%20185.8%200%20256.2%200c70.7%200%20131%2024.8%20180.9%2074.5q74.7%2075.9%2074.7%20181.5'%20style='fill-rule:evenodd;clip-rule:evenodd;fill:%23eee'/%3e%3cpath%20d='m459.7%20100.3-52.9%2052.9c-30.9%2030.9-33.6%2057.8-33.6%20105.3%200%2042.3%206.7%2081.1%2038.2%20112.6%2023%2023%2044.9%2044.7%2044.9%2044.7-5.9%207.2-12.3%2014.3-19.1%2021.2-1.7%202-3.5%203.8-5.5%205.4-6%205.9-12.2%2011.4-18.6%2016.4l-41.4-41.4C334.9%20380.6%20305.6%20377%20257%20377c-46.7%200-78.4%204.3-112.6%2038.5-20.4%2020.4-43.8%2043.9-43.8%2043.9-8.9-6.8-17.3-14.2-25.3-22.4-6.6-6.6-12.8-13.4-18.5-20.3%200%200%2023.1-23.2%2045.2-45.3%2032.7-32.7%2038-70.6%2038-113%200-41.3-6.8-79.8-36.8-109.9C82.2%20127.7%2053.3%2099%2053.3%2099c6.7-8.5%2014-16.7%2021.8-24.5%206.9-6.8%2014-13.1%2021.2-19l48%2048c30.7%2030.7%2070%2038.6%20112.4%2038.6%2043.6%200%2082.8-8.4%20114.7-40.4C391%2082.1%20417%2056.3%20417%2056.3c6.8%205.6%2013.5%2011.6%2020.1%2018.2%208.3%208.3%2015.8%2016.9%2022.6%2025.8'%20style='fill-rule:evenodd;clip-rule:evenodd;fill:%233a3f51'/%3e%3cpath%20d='M186%20269.1c-.5-2.8-.8-5.5-.9-8.4-.1-1.6-.1-3.1-.1-4.7%200-1.7%200-3.2.1-4.7%200-.2%200-.3.1-.5%201-17.4%207.9-32.4%2020.5-45.1%2013.9-13.8%2030.6-20.7%2050.2-20.7s36.3%206.9%2050.2%2020.7c13.8%2014%2020.7%2030.8%2020.7%2050.3s-6.9%2036.2-20.7%2050.2c-.5.5-1%201.1-1.5%201.5q-3.45%203.3-7.2%206-18%2013.2-41.4%2013.2c-23.4%200-29.4-4.4-41.3-13.2-3.1-2.2-6.1-4.7-8.9-7.6-10.8-10.6-17.3-22.9-19.8-37'%20style='fill-rule:evenodd;clip-rule:evenodd;fill:%230cf'/%3e%3cpath%20d='m372.7%20141-35.4%2034.6M72.9%2076.8l96.5%2096.1m199.7%20198.9%2065.6%2067.9m4.4-363.3L372.7%20141M76.6%20438.5l64.6-64.7'%20style='fill:none;stroke:%230cf;stroke-width:2;stroke-miterlimit:1'/%3e%3cpath%20d='m372.7%20141-40%2040.6m-193.3-38.5%2040.6%2040.5M141%20374l39.5-41.1m146.2-3.3%2042.6%2042.4'%20style='fill:none;stroke:%230cf;stroke-width:7;stroke-miterlimit:1'/%3e%3c/svg%3e",Ze="/static/assets/lidarr.svg",et="/static/assets/gear.svg",tt=n.lazy(()=>V(()=>import("./ProcessesView.js"),__vite__mapDeps([0,1,2,3])).then(e=>({default:e.ProcessesView}))),st=n.lazy(()=>V(()=>import("./LogsView.js"),__vite__mapDeps([4,1,2,3,5])).then(e=>({default:e.LogsView}))),F=n.lazy(()=>V(()=>import("./ArrView.js"),__vite__mapDeps([6,1,2,3])).then(e=>({default:e.ArrView}))),rt=n.lazy(()=>V(()=>import("./ConfigView.js"),__vite__mapDeps([7,1,2,5])).then(e=>({default:e.ConfigView})));function K(e){if(!e)return"unknown";const s=e.trim();return s?s[0]==="v"||s[0]==="V"?s:`v${s}`:"unknown"}function nt({currentVersion:e,latestVersion:s,changelog:o,changelogUrl:l,repositoryUrl:r,updateState:a,updating:h,onClose:p,onUpdate:f}){const[i,g]=n.useState(null),d=h||!!a?.in_progress,m=a?.completed_at?new Date(a.completed_at).toLocaleString():null;n.useEffect(()=>{if(a?.last_result==="success"&&a?.completed_at){let _=10;g(_);const S=setInterval(()=>{_-=1,_<=0?(clearInterval(S),window.location.reload()):g(_)},1e3);return()=>clearInterval(S)}},[a?.last_result,a?.completed_at]);let v="",y=null;if(a?.in_progress)v="text-info",y="â³ Update in progress...";else if(a?.last_result==="success")v="text-success",i!==null?y=`âœ“ Update completed! Reloading in ${i}s...`:(y="âœ“ Update completed successfully",m&&(y=`${y} (${m})`));else if(a?.last_result==="error"){v="text-danger";const _=a.last_error?a.last_error.trim():"";y=_?`âœ— Update failed: ${_}`:"âœ— Update failed"}return t.jsx("div",{className:"modal-backdrop",role:"presentation",onClick:p,children:t.jsxs("div",{className:"modal",role:"dialog","aria-modal":"true","aria-labelledby":"changelog-title",onClick:_=>_.stopPropagation(),children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h2",{id:"changelog-title",children:a?.in_progress?"âš™ï¸ Updating...":"ðŸš€ Update Available"}),t.jsxs("button",{className:"btn ghost",type:"button",onClick:p,disabled:a?.in_progress,children:[t.jsx(j,{src:oe}),"Close"]})]}),t.jsxs("div",{className:"modal-body changelog-modal__body",children:[t.jsxs("div",{className:"changelog-meta",children:[t.jsxs("div",{className:"version-comparison",children:[t.jsxs("span",{className:"version-item",children:[t.jsx("strong",{children:"Current:"})," ",t.jsx("span",{className:"version-badge version-current",children:K(e)})]}),t.jsx("span",{className:"version-arrow",children:"â†’"}),t.jsxs("span",{className:"version-item",children:[t.jsx("strong",{children:"Latest:"})," ",t.jsx("span",{className:"version-badge version-latest",children:s?K(s):"Unknown"})]})]}),y?t.jsx("div",{className:`update-status ${v}`,children:y}):null]}),t.jsxs("div",{className:"changelog-section",children:[t.jsx("h3",{children:"What's New"}),t.jsx("pre",{className:"changelog-body",children:o?.trim()?o.trim():"No changelog provided."})]})]}),t.jsxs("div",{className:"modal-footer",children:[t.jsx("div",{className:"changelog-links",children:(l||r)&&t.jsxs("a",{className:"btn ghost small",href:l??r,target:"_blank",rel:"noreferrer",children:[t.jsx(j,{src:ue}),"View on GitHub"]})}),t.jsxs("div",{className:"changelog-buttons",children:[t.jsxs("button",{className:"btn ghost",type:"button",onClick:p,children:[t.jsx(j,{src:oe}),"Close"]}),t.jsxs("button",{className:"btn primary",type:"button",onClick:f,disabled:d,children:[t.jsx(j,{src:de}),d?"Updating...":"Update Now"]})]})]})]})})}function ot(){const[e,s]=n.useState("processes"),[o,l]=n.useState(!1),{push:r}=ce(),{setValue:a}=Ue(),{viewDensity:h,setViewDensity:p}=Fe(),f=Je(),[i,g]=n.useState(null),[d,m]=n.useState(!1),[v,y]=n.useState(!1),[_,S]=n.useState(!1),[R,U]=n.useState(!1),E=n.useRef(0),q=n.useRef(null),B=n.useRef(!1),P=n.useRef(!1),I=n.useRef(null),[L,Y]=n.useState(0),[Q,X]=n.useState(null);n.useEffect(()=>{(async()=>{if("caches"in window)try{const c=await caches.keys();await Promise.all(c.map(b=>caches.delete(b))),console.log("Cache cleared on page load")}catch(c){console.error("Failed to clear cache:",c)}})()},[]);const k=n.useCallback(async u=>{const c=u?.force??!1,b=u?.silent??!c;b||m(!0);try{const C=await re({force:c});g(C)}catch(C){if(!b){const w=C instanceof Error?C.message:"Failed to fetch version information";r(w,"error")}}finally{b||m(!1)}},[r]);n.useEffect(()=>{k({force:!0})},[k]),n.useEffect(()=>{f||r("You are offline. Some features may not work.","warning")},[f,r]),n.useEffect(()=>{const u=c=>{if(c.target instanceof HTMLInputElement||c.target instanceof HTMLTextAreaElement||c.target instanceof HTMLSelectElement)return;const b=c.ctrlKey||c.metaKey;if(b&&c.key==="k"){c.preventDefault(),document.querySelector('input[type="text"][placeholder*="Search"]')?.focus();return}if(c.key==="r"||c.key==="R"){c.preventDefault(),Y(C=>C+1),r("Refreshed","success");return}if(c.key==="Escape"){a("");return}if(c.key>="1"&&c.key<="6"&&!b){c.preventDefault();const C=parseInt(c.key)-1,w=["processes","logs","radarr","sonarr","lidarr","config"];C<w.length&&s(w[C]);return}};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[a,r]),n.useEffect(()=>{const u=window.setInterval(()=>{k()},3e5);return()=>window.clearInterval(u)},[k]),n.useEffect(()=>{const u=()=>{document.visibilityState==="visible"&&(Y(c=>c+1),k({force:!0}),A())};return document.addEventListener("visibilitychange",u),()=>{document.removeEventListener("visibilitychange",u)}},[k]);const A=n.useCallback(async()=>{try{const u=await ne();X(u)}catch{}},[]);n.useEffect(()=>{A();const u=window.setInterval(()=>{A()},30*1e3);return()=>window.clearInterval(u)},[A]),n.useEffect(()=>{if(!i?.update_state?.in_progress&&!R){E.current=0;return}const u=window.setInterval(async()=>{try{const c=await re({force:!0});g(c),R&&window.location.reload(),E.current=0}catch{if(E.current+=1,E.current>20){U(!1),E.current=0,r("Update completed but backend restart timed out. Please refresh the page manually.","warning");return}i?.update_state?.in_progress&&U(!0)}},3e3);return()=>window.clearInterval(u)},[i?.update_state?.in_progress,R,i,r]),n.useEffect(()=>{const u=i?.update_state;if(!u){q.current=null;return}const c=u.last_result??null;c&&c!==q.current&&(c==="success"?(r("Update completed successfully. Restarting...","success"),U(!0),E.current=0):c==="error"&&r(u.last_error||"Update failed.","error")),q.current=c},[i?.update_state,r]),n.useEffect(()=>{let u=!1,c=0;const b=w=>{I.current!==null&&window.clearTimeout(I.current),I.current=window.setTimeout(()=>{C()},w)},C=async()=>{if(!(u||B.current)){c+=1;try{const w=await ne();if(u)return;if(X(w),w.ready??(Array.isArray(w.arrs)&&w.arrs.length>0)){B.current=!0;return}w.ready===!1&&c>=3&&!P.current&&(P.current=!0,r("qBitrr backend is still initialising. Check the logs if this persists.","warning"))}catch(w){if(!P.current&&c>=3){P.current=!0;const D=w instanceof Error?w.message:"Unknown backend error";r(`Unable to confirm qBitrr readiness (${D}). Please inspect the logs.`,"warning")}}finally{if(!u&&!B.current){const w=c<3?3e3:1e4;b(w)}}}};return b(0),()=>{u=!0,I.current!==null&&(window.clearTimeout(I.current),I.current=null)}},[r]);const $=n.useMemo(()=>{const u=[{id:"processes",label:"Processes",icon:Ge},{id:"logs",label:"Logs",icon:Ye}],c=[],b=Q?.arrs??[],C=b.some(N=>N.type==="radarr"),w=b.some(N=>N.type==="sonarr"),D=b.some(N=>N.type==="lidarr");return C&&c.push({id:"radarr",label:"Radarr",icon:Qe}),w&&c.push({id:"sonarr",label:"Sonarr",icon:Xe}),D&&c.push({id:"lidarr",label:"Lidarr",icon:Ze}),[...u,...c,{id:"config",label:"Config",icon:et}]},[Q]),W=i?.repository_url??"https://github.com/Feramance/qBitrr",fe=i?.current_version?K(i.current_version):"...",me=i?.latest_version??null,he=!!i?.update_available,H=i?.update_state,pe=i?.changelog_url??W,O=[];i?.last_checked&&O.push(`Last checked ${new Date(i.last_checked).toLocaleString()}`),i?.error&&O.push(`Update check failed: ${i.error}`);const ge=O.length?O.join(" â€¢ "):void 0;n.useEffect(()=>{!$.some(c=>c.id===e)&&$.length>0&&s("processes")},[$,e]);const ve=n.useCallback(()=>{k({force:!0})},[k]),we=n.useCallback(()=>{y(!0),i?.changelog||k({force:!0,silent:!0})},[i?.changelog,k]),ye=n.useCallback(()=>{y(!1)},[]),be=n.useCallback(async()=>{S(!0),U(!1),E.current=0;try{await He(),r("Update started in the background.","info"),await k({force:!0,silent:!0})}catch(u){const c=u instanceof Error?u.message:"Failed to start update";r(c,"error")}finally{S(!1)}},[r,k]);return t.jsxs("div",{"data-density":h,children:[t.jsx("header",{className:"appbar",children:t.jsxs("div",{className:"appbar__inner",children:[t.jsxs("div",{className:"appbar__title",children:[t.jsx("h1",{children:"qBitrr"}),t.jsx("span",{className:"appbar__version",title:ge,children:fe}),d?t.jsx("span",{className:"spinner","aria-hidden":"true"}):null,H?.in_progress?t.jsx("span",{className:"appbar__status text-info",children:"Updating..."}):null,he?t.jsxs("button",{type:"button",className:"btn small primary appbar__update",onClick:we,disabled:_||!!H?.in_progress,children:[t.jsx("span",{className:"appbar__update-indicator","aria-hidden":"true"}),t.jsx(j,{src:de}),"Update available"]}):null]}),t.jsxs("div",{className:"appbar__actions",children:[!f&&t.jsx("span",{className:"badge",style:{background:"rgba(239, 68, 68, 0.15)",borderColor:"rgba(239, 68, 68, 0.3)",color:"var(--danger)"},children:"Offline"}),t.jsxs("div",{className:"view-density-toggle",children:[t.jsx("button",{type:"button",className:h==="comfortable"?"active":"",onClick:()=>p("comfortable"),title:"Comfortable view",children:"Comfortable"}),t.jsx("button",{type:"button",className:h==="compact"?"active":"",onClick:()=>p("compact"),title:"Compact view",children:"Compact"})]}),t.jsxs("button",{type:"button",className:"btn small ghost",onClick:ve,disabled:d,children:[t.jsx(j,{src:Ke}),d?"Checking...":"Check Updates"]}),t.jsxs("a",{href:W,target:"_blank",rel:"noreferrer",className:"btn small ghost",children:[t.jsx(j,{src:ue}),"GitHub"]})]})]})}),t.jsxs("main",{className:"container",children:[t.jsx("nav",{className:"nav",children:$.map(u=>t.jsxs("button",{type:"button",className:e===u.id?"active":"",onClick:()=>{e==="config"&&u.id!=="config"&&o&&!window.confirm("You have unsaved configuration changes. Leave without saving?")||(s(u.id),a(""))},children:[t.jsx(j,{src:u.icon}),t.jsx("span",{children:u.label})]},u.id))}),t.jsxs(n.Suspense,{fallback:t.jsx("div",{className:"loading",children:"Loading..."}),children:[e==="processes"&&t.jsx(tt,{active:!0},`processes-${L}`),e==="logs"&&t.jsx(st,{active:!0},`logs-${L}`),e==="radarr"&&t.jsx(F,{type:"radarr",active:!0},`radarr-${L}`),e==="sonarr"&&t.jsx(F,{type:"sonarr",active:!0},`sonarr-${L}`),e==="lidarr"&&t.jsx(F,{type:"lidarr",active:!0},`lidarr-${L}`),e==="config"&&t.jsx(rt,{onDirtyChange:l},`config-${L}`)]})]}),v&&i?t.jsx(nt,{currentVersion:i.current_version,latestVersion:me,changelog:i.changelog,changelogUrl:pe,repositoryUrl:W,updateState:H,updating:_,onClose:ye,onUpdate:be}):null]})}function at(){return t.jsx(Le,{children:t.jsx(Te,{children:t.jsxs(ze,{children:[t.jsx(ot,{}),t.jsx(Ne,{})]})})})}Se.createRoot(document.getElementById("root")).render(t.jsx(n.StrictMode,{children:t.jsx(at,{})}));export{oe as C,j as I,Ke as R,ne as a,dt as b,ft as c,mt as d,ht as e,pt as f,lt as g,Ue as h,Fe as i,t as j,gt as k,vt as l,bt as m,wt as n,yt as o,Be as p,We as q,ut as r,et as s,ce as u};
//# sourceMappingURL=app.js.map
