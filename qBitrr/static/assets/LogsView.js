import{u as E,d as T,e as H,j as s,I as C,R as I,f as R}from"./app.js";import{r as c}from"./table.js";import{u as F}from"./useInterval.js";import{S as D}from"./react-select.esm.js";import"./vendor.js";const M="/static/assets/download.svg",A="/static/assets/live-streaming.svg",W=()=>{const n=document.documentElement.getAttribute("data-theme")==="dark";return{control:l=>({...l,background:n?"#0f131a":"#ffffff",color:n?"#eaeef2":"#1d1d1f",borderColor:n?"#2a2f36":"#d2d2d7",minHeight:"38px",boxShadow:"none","&:hover":{borderColor:n?"#3a4149":"#b8b8bd"}}),menu:l=>({...l,background:n?"#0f131a":"#ffffff",borderColor:n?"#2a2f36":"#d2d2d7",border:`1px solid ${n?"#2a2f36":"#d2d2d7"}`}),option:(l,u)=>({...l,background:u.isFocused?n?"rgba(122, 162, 247, 0.15)":"rgba(0, 113, 227, 0.1)":n?"#0f131a":"#ffffff",color:n?"#eaeef2":"#1d1d1f","&:active":{background:n?"rgba(122, 162, 247, 0.25)":"rgba(0, 113, 227, 0.2)"}}),singleValue:l=>({...l,color:n?"#eaeef2":"#1d1d1f"}),input:l=>({...l,color:n?"#eaeef2":"#1d1d1f"}),placeholder:l=>({...l,color:n?"#9aa3ac":"#6e6e73"}),menuList:l=>({...l,padding:"4px"})}};function B(n){const l={30:"#000000",31:"#cd3131",32:"#0dbc79",33:"#e5e510",34:"#2472c8",35:"#bc3fbc",36:"#11a8cd",37:"#e5e5e5",90:"#666666",91:"#f14c4c",92:"#23d18b",93:"#f5f543",94:"#3b8eea",95:"#d670d6",96:"#29b8db",97:"#ffffff"},u={40:"#000000",41:"#cd3131",42:"#0dbc79",43:"#e5e510",44:"#2472c8",45:"#bc3fbc",46:"#11a8cd",47:"#e5e5e5",100:"#666666",101:"#f14c4c",102:"#23d18b",103:"#f5f543",104:"#3b8eea",105:"#d670d6",106:"#29b8db",107:"#ffffff"};let a=n,e=[];return a=a.replace(/\u001b\[([0-9;]+)m/g,(g,y)=>{const h=y.split(";");let d="";for(const r of h)r==="0"||r===""?(d+="</span>".repeat(e.length),e=[]):r==="1"?(e.push("font-weight:bold"),d+=`<span style="${e.join(";")}">`):r==="3"?(e.push("font-style:italic"),d+=`<span style="${e.join(";")}">`):r==="4"?(e.push("text-decoration:underline"),d+=`<span style="${e.join(";")}">`):r==="22"?e=e.filter(i=>!i.includes("font-weight")):r==="23"?e=e.filter(i=>!i.includes("font-style")):r==="24"?e=e.filter(i=>!i.includes("text-decoration")):l[r]?(e=e.filter(i=>!i.startsWith("color:")),e.push(`color:${l[r]}`),d+=`<span style="${e.join(";")}">`):u[r]?(e=e.filter(i=>!i.startsWith("background-color:")),e.push(`background-color:${u[r]}`),d+=`<span style="${e.join(";")}">`):r==="39"?e=e.filter(i=>!i.startsWith("color:")):r==="49"&&(e=e.filter(i=>!i.startsWith("background-color:")));return d}),a+="</span>".repeat(e.length),a=a.replace(/\n/g,"<br>"),a}function U({active:n}){const[l,u]=c.useState([]),[a,e]=c.useState("Main.log"),[g,y]=c.useState(""),[h,d]=c.useState(!0),[r,i]=c.useState(!1),[L,k]=c.useState(!1),p=c.useRef(null),w=c.useRef(null),{push:m}=E(),b=c.useCallback((t,o)=>t instanceof Error&&t.message?`${o}: ${t.message}`:typeof t=="string"&&t.trim().length?`${o}: ${t}`:o,[]),j=c.useCallback(async()=>{i(!0);try{const o=(await T()).files??[];u(o),o.length?e(f=>f&&o.includes(f)?f:o.find(S=>S.toLowerCase()==="main.log")??null??o[0]):e("")}catch(t){m(b(t,"Failed to refresh log list"),"error")}finally{i(!1)}},[b,m]),v=c.useCallback(async(t,o=!1)=>{if(t){o&&k(!0);try{const f=await H(t);y(f)}catch(f){m(b(f,`Failed to read ${t}`),"error")}finally{o&&k(!1)}}},[b,m]);return c.useEffect(()=>{if(!h||!g||!p.current)return;const t=()=>{if(p.current){const o=p.current;o.offsetHeight,o.scrollTop=o.scrollHeight}};t(),requestAnimationFrame(t),setTimeout(t,50),setTimeout(t,100)},[g,h]),c.useEffect(()=>{const t=p.current;if(!t)return;let o=t.scrollTop;const f=()=>{const{scrollTop:x,scrollHeight:S,clientHeight:$}=t,N=S-x-$<50;x<o&&!N&&d(!1),o=x};return t.addEventListener("scroll",f,{passive:!0}),()=>{t.removeEventListener("scroll",f)}},[]),c.useEffect(()=>{j()},[j]),c.useEffect(()=>{a&&v(a,!0)},[a,v]),F(()=>{a&&v(a,!1)},n?2e3:null),s.jsxs("section",{className:"card",style:{height:"calc(100vh - 140px)",display:"flex",flexDirection:"column",margin:0,padding:0},children:[s.jsx("div",{className:"card-header",style:{flexShrink:0},children:"Logs"}),s.jsxs("div",{className:"card-body",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",padding:"12px"},children:[s.jsxs("div",{className:"row",style:{flexShrink:0,marginBottom:"12px"},children:[s.jsx("div",{className:"col field",children:s.jsxs("div",{className:"field",children:[s.jsx("label",{children:"Log File"}),s.jsx(D,{options:l.map(t=>({value:t,label:t})),value:a?{value:a,label:a}:null,onChange:t=>e(t?.value||""),isDisabled:!l.length,styles:W()})]})}),s.jsxs("div",{className:"col field",children:[s.jsx("label",{children:"Â "}),s.jsxs("div",{className:"row",style:{alignItems:"center"},children:[s.jsxs("button",{className:"btn ghost",onClick:()=>void j(),disabled:r,children:[s.jsx(C,{src:I}),"Reload List"]}),s.jsxs("button",{className:"btn",onClick:()=>a&&window.open(R(a),"_blank"),disabled:!a,children:[s.jsx(C,{src:M}),"Download"]}),s.jsxs("label",{className:"hint inline",style:{cursor:"pointer"},children:[s.jsx("input",{type:"checkbox",checked:h,onChange:t=>d(t.target.checked)}),s.jsx(C,{src:A}),s.jsx("span",{children:"Auto-scroll"})]})]})]})]}),s.jsx("div",{ref:p,style:{flex:1,minHeight:0,overflow:"auto",backgroundColor:"#0a0e14",borderRadius:"4px",padding:"16px"},children:L?s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#666"},children:[s.jsx("span",{className:"spinner",style:{marginRight:"8px"}}),"Loading logs..."]}):g?s.jsx("pre",{ref:w,style:{margin:0,whiteSpace:"pre-wrap",fontFamily:'"Cascadia Code", "Fira Code", "Consolas", "Monaco", monospace',fontSize:"13px",lineHeight:"1.5",color:"#e5e5e5",tabSize:4,minHeight:"100%"},dangerouslySetInnerHTML:{__html:B(g)}}):s.jsx("div",{style:{color:"#666"},children:"Select a log file to view its tail..."})})]})]})}export{U as LogsView};
//# sourceMappingURL=LogsView.js.map
