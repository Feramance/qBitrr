import{u as $,d as E,e as N,j as s,I as k,R as H,f as I}from"./app.js";import{r as i}from"./table.js";import{u as R}from"./useInterval.js";import{S as F}from"./react-select.esm.js";import"./vendor.js";const T="/static/assets/download.svg",D="/static/assets/live-streaming.svg",M=()=>{const o=document.documentElement.getAttribute("data-theme")==="dark";return{control:l=>({...l,background:o?"#0f131a":"#ffffff",color:o?"#eaeef2":"#1d1d1f",borderColor:o?"#2a2f36":"#d2d2d7",minHeight:"38px",boxShadow:"none","&:hover":{borderColor:o?"#3a4149":"#b8b8bd"}}),menu:l=>({...l,background:o?"#0f131a":"#ffffff",borderColor:o?"#2a2f36":"#d2d2d7",border:`1px solid ${o?"#2a2f36":"#d2d2d7"}`}),option:(l,h)=>({...l,background:h.isFocused?o?"rgba(122, 162, 247, 0.15)":"rgba(0, 113, 227, 0.1)":o?"#0f131a":"#ffffff",color:o?"#eaeef2":"#1d1d1f","&:active":{background:o?"rgba(122, 162, 247, 0.25)":"rgba(0, 113, 227, 0.2)"}}),singleValue:l=>({...l,color:o?"#eaeef2":"#1d1d1f"}),input:l=>({...l,color:o?"#eaeef2":"#1d1d1f"}),placeholder:l=>({...l,color:o?"#9aa3ac":"#6e6e73"}),menuList:l=>({...l,padding:"4px"})}};function A(o){const l={30:"#000000",31:"#cd3131",32:"#0dbc79",33:"#e5e510",34:"#2472c8",35:"#bc3fbc",36:"#11a8cd",37:"#e5e5e5",90:"#666666",91:"#f14c4c",92:"#23d18b",93:"#f5f543",94:"#3b8eea",95:"#d670d6",96:"#29b8db",97:"#ffffff"},h={40:"#000000",41:"#cd3131",42:"#0dbc79",43:"#e5e510",44:"#2472c8",45:"#bc3fbc",46:"#11a8cd",47:"#e5e5e5",100:"#666666",101:"#f14c4c",102:"#23d18b",103:"#f5f543",104:"#3b8eea",105:"#d670d6",106:"#29b8db",107:"#ffffff"};let r=o,e=[];return r=r.replace(/\u001b\[([0-9;]+)m/g,(y,j)=>{const d=j.split(";");let f="";for(const n of d)n==="0"||n===""?(f+="</span>".repeat(e.length),e=[]):n==="1"?(e.push("font-weight:bold"),f+=`<span style="${e.join(";")}">`):n==="3"?(e.push("font-style:italic"),f+=`<span style="${e.join(";")}">`):n==="4"?(e.push("text-decoration:underline"),f+=`<span style="${e.join(";")}">`):n==="22"?e=e.filter(a=>!a.includes("font-weight")):n==="23"?e=e.filter(a=>!a.includes("font-style")):n==="24"?e=e.filter(a=>!a.includes("text-decoration")):l[n]?(e=e.filter(a=>!a.startsWith("color:")),e.push(`color:${l[n]}`),f+=`<span style="${e.join(";")}">`):h[n]?(e=e.filter(a=>!a.startsWith("background-color:")),e.push(`background-color:${h[n]}`),f+=`<span style="${e.join(";")}">`):n==="39"?e=e.filter(a=>!a.startsWith("color:")):n==="49"&&(e=e.filter(a=>!a.startsWith("background-color:")));return f}),r+="</span>".repeat(e.length),r=r.replace(/\n/g,"<br>"),r}function q({active:o}){const[l,h]=i.useState([]),[r,e]=i.useState("Main.log"),[y,j]=i.useState(""),[d,f]=i.useState(!0),[n,a]=i.useState(!1),[L,w]=i.useState(!1),u=i.useRef(null),b=i.useRef(!1),{push:m}=$(),x=i.useCallback((t,c)=>t instanceof Error&&t.message?`${c}: ${t.message}`:typeof t=="string"&&t.trim().length?`${c}: ${t}`:c,[]),v=i.useCallback(async()=>{a(!0);try{const c=(await E()).files??[];h(c),c.length?e(g=>g&&c.includes(g)?g:c.find(C=>C.toLowerCase()==="main.log")??null??c[0]):e("")}catch(t){m(x(t,"Failed to refresh log list"),"error")}finally{a(!1)}},[x,m]),S=i.useCallback(async(t,c,g=!1)=>{if(t){g&&w(!0);try{const p=await N(t);j(p),window.requestAnimationFrame(()=>{u.current&&c&&!b.current&&(u.current.scrollTop=u.current.scrollHeight)})}catch(p){m(x(p,`Failed to read ${t}`),"error")}finally{g&&w(!1)}}},[x,m]);return i.useEffect(()=>{const t=u.current;if(!t)return;const c=()=>{if(!d)return;const{scrollTop:g,scrollHeight:p,clientHeight:C}=t;!(Math.abs(p-g-C)<10)&&!b.current&&(b.current=!0,f(!1))};return t.addEventListener("scroll",c),()=>t.removeEventListener("scroll",c)},[d]),i.useEffect(()=>{d&&(b.current=!1,u.current&&(u.current.scrollTop=u.current.scrollHeight))},[d]),i.useEffect(()=>{v()},[v]),i.useEffect(()=>{r&&S(r,d,!0)},[r,S,d]),R(()=>{r&&S(r,d)},o&&d?2e3:null),s.jsxs("section",{className:"card",style:{height:"calc(100vh - 140px)",display:"flex",flexDirection:"column",margin:0,padding:0},children:[s.jsx("div",{className:"card-header",style:{flexShrink:0},children:"Logs"}),s.jsxs("div",{className:"card-body",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",padding:"12px"},children:[s.jsxs("div",{className:"row",style:{flexShrink:0,marginBottom:"12px"},children:[s.jsx("div",{className:"col field",children:s.jsxs("div",{className:"field",children:[s.jsx("label",{children:"Log File"}),s.jsx(F,{options:l.map(t=>({value:t,label:t})),value:r?{value:r,label:r}:null,onChange:t=>e(t?.value||""),isDisabled:!l.length,styles:M()})]})}),s.jsxs("div",{className:"col field",children:[s.jsx("label",{children:"Â "}),s.jsxs("div",{className:"row",style:{alignItems:"center"},children:[s.jsxs("button",{className:"btn ghost",onClick:()=>void v(),disabled:n,children:[s.jsx(k,{src:H}),"Reload List"]}),s.jsxs("button",{className:"btn",onClick:()=>r&&window.open(I(r),"_blank"),disabled:!r,children:[s.jsx(k,{src:T}),"Download"]}),s.jsxs("label",{className:"hint inline",style:{cursor:"pointer"},children:[s.jsx("input",{type:"checkbox",checked:d,onChange:t=>f(t.target.checked)}),s.jsx(k,{src:D}),s.jsx("span",{children:"Auto-scroll"})]})]})]})]}),s.jsx("div",{ref:u,style:{flex:1,minHeight:0,overflow:"auto",backgroundColor:"#0a0e14",borderRadius:"4px",padding:"16px"},children:L?s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#666"},children:[s.jsx("span",{className:"spinner",style:{marginRight:"8px"}}),"Loading logs..."]}):y?s.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontFamily:'"Cascadia Code", "Fira Code", "Consolas", "Monaco", monospace',fontSize:"13px",lineHeight:"1.5",color:"#e5e5e5",tabSize:4,minHeight:"100%"},dangerouslySetInnerHTML:{__html:A(y)}}):s.jsx("div",{style:{color:"#666"},children:"Select a log file to view its tail..."})})]})]})}export{q as LogsView};
//# sourceMappingURL=LogsView.js.map
