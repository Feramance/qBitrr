import{u as N,d as E,e as R,j as s,I as w,R as F,f as I}from"./app.js";import{r as c}from"./table.js";import{u as D}from"./useInterval.js";import{S as M}from"./react-select.esm.js";import"./vendor.js";const A="/static/assets/download.svg",V="/static/assets/live-streaming.svg",B=()=>{const r=document.documentElement.getAttribute("data-theme")==="dark";return{control:o=>({...o,background:r?"#0f131a":"#ffffff",color:r?"#eaeef2":"#1d1d1f",borderColor:r?"#2a2f36":"#d2d2d7",minHeight:"38px",boxShadow:"none","&:hover":{borderColor:r?"#3a4149":"#b8b8bd"}}),menu:o=>({...o,background:r?"#0f131a":"#ffffff",borderColor:r?"#2a2f36":"#d2d2d7",border:`1px solid ${r?"#2a2f36":"#d2d2d7"}`}),option:(o,u)=>({...o,background:u.isFocused?r?"rgba(122, 162, 247, 0.15)":"rgba(0, 113, 227, 0.1)":r?"#0f131a":"#ffffff",color:r?"#eaeef2":"#1d1d1f","&:active":{background:r?"rgba(122, 162, 247, 0.25)":"rgba(0, 113, 227, 0.2)"}}),singleValue:o=>({...o,color:r?"#eaeef2":"#1d1d1f"}),input:o=>({...o,color:r?"#eaeef2":"#1d1d1f"}),placeholder:o=>({...o,color:r?"#9aa3ac":"#6e6e73"}),menuList:o=>({...o,padding:"4px"})}};function W(r){const o={30:"#000000",31:"#cd3131",32:"#0dbc79",33:"#e5e510",34:"#2472c8",35:"#bc3fbc",36:"#11a8cd",37:"#e5e5e5",90:"#666666",91:"#f14c4c",92:"#23d18b",93:"#f5f543",94:"#3b8eea",95:"#d670d6",96:"#29b8db",97:"#ffffff"},u={40:"#000000",41:"#cd3131",42:"#0dbc79",43:"#e5e510",44:"#2472c8",45:"#bc3fbc",46:"#11a8cd",47:"#e5e5e5",100:"#666666",101:"#f14c4c",102:"#23d18b",103:"#f5f543",104:"#3b8eea",105:"#d670d6",106:"#29b8db",107:"#ffffff"};let n=r,t=[];return n=n.replace(/\u001b\[([0-9;]+)m/g,(g,y)=>{const h=y.split(";");let f="";for(const i of h)i==="0"||i===""?(f+="</span>".repeat(t.length),t=[]):i==="1"?(t.push("font-weight:bold"),f+=`<span style="${t.join(";")}">`):i==="3"?(t.push("font-style:italic"),f+=`<span style="${t.join(";")}">`):i==="4"?(t.push("text-decoration:underline"),f+=`<span style="${t.join(";")}">`):i==="22"?t=t.filter(a=>!a.includes("font-weight")):i==="23"?t=t.filter(a=>!a.includes("font-style")):i==="24"?t=t.filter(a=>!a.includes("text-decoration")):o[i]?(t=t.filter(a=>!a.startsWith("color:")),t.push(`color:${o[i]}`),f+=`<span style="${t.join(";")}">`):u[i]?(t=t.filter(a=>!a.startsWith("background-color:")),t.push(`background-color:${u[i]}`),f+=`<span style="${t.join(";")}">`):i==="39"?t=t.filter(a=>!a.startsWith("color:")):i==="49"&&(t=t.filter(a=>!a.startsWith("background-color:")));return f}),n+="</span>".repeat(t.length),n=n.replace(/\n/g,"<br>"),n}function U({active:r}){const[o,u]=c.useState([]),[n,t]=c.useState("Main.log"),[g,y]=c.useState(""),[h,f]=c.useState(!0),[i,a]=c.useState(!1),[k,L]=c.useState(!1),p=c.useRef(null),C=c.useRef(null),H=c.useRef(null),{push:m}=N(),b=c.useCallback((e,l)=>e instanceof Error&&e.message?`${l}: ${e.message}`:typeof e=="string"&&e.trim().length?`${l}: ${e}`:l,[]),v=c.useCallback(async()=>{a(!0);try{const l=(await E()).files??[];u(l),l.length?t(d=>d&&l.includes(d)?d:l.find(S=>S.toLowerCase()==="main.log")??null??l[0]):t("")}catch(e){m(b(e,"Failed to refresh log list"),"error")}finally{a(!1)}},[b,m]),j=c.useCallback(async(e,l=!1)=>{if(e){l&&L(!0);try{const d=await R(e);y(d)}catch(d){m(b(d,`Failed to read ${e}`),"error")}finally{l&&L(!1)}}},[b,m]);return c.useEffect(()=>{if(!h||!g||!p.current)return;const e=p.current,l=()=>{console.log("[LogsView] Attempting scroll:",{scrollHeight:e.scrollHeight,clientHeight:e.clientHeight,currentScrollTop:e.scrollTop,maxScroll:e.scrollHeight-e.clientHeight}),e.scrollTop=e.scrollHeight-e.clientHeight+100,console.log("[LogsView] After scroll attempt:",{newScrollTop:e.scrollTop,distanceFromBottom:e.scrollHeight-e.scrollTop-e.clientHeight})},d=new MutationObserver(()=>{console.log("[LogsView] DOM mutated, scrolling..."),l()});return d.observe(e,{childList:!0,subtree:!0,characterData:!0}),l(),requestAnimationFrame(l),setTimeout(l,100),setTimeout(l,300),()=>d.disconnect()},[g,h]),c.useEffect(()=>{const e=p.current;if(!e)return;let l=e.scrollTop;const d=()=>{const{scrollTop:x,scrollHeight:S,clientHeight:T}=e,$=S-x-T<50;x<l&&!$&&f(!1),l=x};return e.addEventListener("scroll",d,{passive:!0}),()=>{e.removeEventListener("scroll",d)}},[]),c.useEffect(()=>{v()},[v]),c.useEffect(()=>{n&&j(n,!0)},[n,j]),D(()=>{n&&j(n,!1)},r?2e3:null),s.jsxs("section",{className:"card",style:{height:"calc(100vh - 140px)",display:"flex",flexDirection:"column",margin:0,padding:0},children:[s.jsx("div",{className:"card-header",style:{flexShrink:0},children:"Logs"}),s.jsxs("div",{className:"card-body",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",padding:"12px"},children:[s.jsxs("div",{className:"row",style:{flexShrink:0,marginBottom:"12px"},children:[s.jsx("div",{className:"col field",children:s.jsxs("div",{className:"field",children:[s.jsx("label",{children:"Log File"}),s.jsx(M,{options:o.map(e=>({value:e,label:e})),value:n?{value:n,label:n}:null,onChange:e=>t(e?.value||""),isDisabled:!o.length,styles:B()})]})}),s.jsxs("div",{className:"col field",children:[s.jsx("label",{children:"Â "}),s.jsxs("div",{className:"row",style:{alignItems:"center"},children:[s.jsxs("button",{className:"btn ghost",onClick:()=>void v(),disabled:i,children:[s.jsx(w,{src:F}),"Reload List"]}),s.jsxs("button",{className:"btn",onClick:()=>n&&window.open(I(n),"_blank"),disabled:!n,children:[s.jsx(w,{src:A}),"Download"]}),s.jsxs("label",{className:"hint inline",style:{cursor:"pointer"},children:[s.jsx("input",{type:"checkbox",checked:h,onChange:e=>f(e.target.checked)}),s.jsx(w,{src:V}),s.jsx("span",{children:"Auto-scroll"})]})]})]})]}),s.jsx("div",{ref:p,style:{flex:1,minHeight:0,overflow:"auto",backgroundColor:"#0a0e14",borderRadius:"4px",padding:"16px"},children:k?s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#666"},children:[s.jsx("span",{className:"spinner",style:{marginRight:"8px"}}),"Loading logs..."]}):g?s.jsxs(s.Fragment,{children:[s.jsx("pre",{ref:C,style:{margin:0,whiteSpace:"pre-wrap",fontFamily:'"Cascadia Code", "Fira Code", "Consolas", "Monaco", monospace',fontSize:"13px",lineHeight:"1.5",color:"#e5e5e5",tabSize:4,minHeight:"100%"},dangerouslySetInnerHTML:{__html:W(g)}}),s.jsx("div",{ref:H,style:{height:"1px",width:"1px"}})]}):s.jsx("div",{style:{color:"#666"},children:"Select a log file to view its tail..."})})]})]})}export{U as LogsView};
//# sourceMappingURL=LogsView.js.map
